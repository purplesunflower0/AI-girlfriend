<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <meta charset="UTF-8" />
  <title>AI Girlfriend üíó</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
  * {
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(145deg, #ffeef2, #f3d1da);
    margin: 0;
    padding: 0;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    transition: background 0.3s ease;
  }

  body.dark-mode {
    background: linear-gradient(145deg, #1e1e2f, #2d2d3c);
    color: white;
  }

  .container {
    min-height: 0;
    margin-top: 10px;
    width: 95%;
    max-width: 500px;
    height: 95%;
    background: #ffffffcc;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid #f3b5c0;
    transition: background 0.3s ease, border-color 0.3s ease;
  }

  body.dark-mode .container {
    background: #2a2a3c;
    border-color: #444;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #fff0f6;
    padding: 12px 20px;
  }

  body.dark-mode .header {
    background-color: #3a3a50;
  }

  .header h2 {
    margin: 0;
    color: #d63384;
  }

  body.dark-mode .header h2 {
    color: #ff85a2;
  }

  .header button {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    color: inherit;
  }

  .mood-select {
    padding: 8px 20px;
    background: #fff6fa;
  }

  body.dark-mode .mood-select {
    background: #3a3a50;
  }

  select {
    width: 100%;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid #ccc;
    font-size: 16px;
    background: #fff0f6;
    color: #333;
  }

  body.dark-mode select {
    background: #44445f;
    color: white;
    border: 1px solid #666;
  }

  #chat-box {
    flex: 1 1 auto;
    min-height: 0;
    overflow-y: auto;
    padding: 20px;
    background: #fff;
    display: flex;
    flex-direction: column;
  }

  body.dark-mode #chat-box {
    background: #2e2e42;
  }

  .user, .bot {
    max-width: 80%;
    padding: 10px 15px;
    margin: 8px 0;
    border-radius: 18px;
    line-height: 1.4;
    word-wrap: break-word;
  }

  .user {
    background: #d0e8ff;
    align-self: flex-end;
    text-align: right;
    margin-left: auto;
  }

  .bot {
    background: #ffd1dc;
    align-self: flex-start;
    text-align: left;
    margin-right: auto;
  }

  body.dark-mode .user {
    background: #5b9bd5;
    color: white;
  }

  body.dark-mode .bot {
    background: #ff99b9;
    color: black;
  }

  .input-area {
    flex-shrink: 0;
    display: flex;
    padding: 10px;
    border-top: 1px solid #f3b5c0;
    background: #fff;
    gap: 8px;
  }

  body.dark-mode .input-area {
    background: #3a3a50;
    border-top: 1px solid #666;
  }

  input {
    flex: 1;
    padding: 10px 15px;
    border-radius: 12px;
    border: 1px solid #ccc;
    font-size: 16px;
    width: 100%;
    max-width: unset;
  }

  body.dark-mode input {
    background: #55556e;
    color: white;
    border: 1px solid #888;
  }

  button.send {
    margin-left: 10px;
    padding: 10px 16px;
    background: #d63384;
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  button.send:hover {
    background: #b6246c;
  }

    .typing-dots {
        display: inline-flex;
        align-items: flex-end;
        margin-left: 5px;
        
    }

    .typing-dots span {
        font-size: 18px;
        margin: 0 2px;
        animation: bounce 0.6s infinite;
    }

    .typing-dots span:nth-child(1) {
        animation-delay: 0s;
    }
    .typing-dots span:nth-child(2) {
        animation-delay: 0.1s;
    }
    .typing-dots span:nth-child(3) {
        animation-delay: 0.2s;
    }

    @keyframes bounce {
        0%, 80%, 100% {
            transform: translateY(0);
    }
        40% {
            transform: translateY(-8px);
        }
    }
    .switch {
        position: relative;
        display: inline-block;
        width: 42px;
        height: 22px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        border-radius: 22px;
        transition: background-color 0.4s;
    }

    .slider:before {
        content: var(--emoji, "üåô");
        content: "üåô";
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: #000;
        height: 18px;
        width: 18px;
        position: absolute;
        left: 2px;
        bottom: 2px;
        background-color: white;
        border-radius: 50%;
        transition: transform 0.4s;
    }

    input:checked + .slider:before {
        transform: translateX(26px);
        content: "‚òÄÔ∏è";
    }

</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h2>Bunnyluzy</h2>
    <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
    </label>
  </div>

  <div class="mood-select">
    <select id="mood">
      <option value="romantic" selected>Romantic üíñ</option>
      <option value="flirty">Flirty üòè</option>
      <option value="jealous">Jealous üò°</option>
      <option value="caring">Caring ü•∫</option>
      <option value="chaotic">Chaotic ü§Ø</option>
    </select>
  </div>

  <div id="chat-box"></div>

  <div class="input-area">
    <input type="text" id="user-input" placeholder="Say something..." />
    <button class="send" onclick="sendMessage()">‚û§</button>
  </div>
</div>

<script>

  const userId = "user123";
  let selectedMood = "romantic";

  const toggleSwitch = document.getElementById("themeToggle");
  const slider = document.querySelector(".slider");

  toggleSwitch.addEventListener("change", () => {
    document.body.classList.toggle("dark-mode");

    // Emoji change
    const isDark = document.body.classList.contains("dark-mode");
    slider.style.setProperty('--emoji', isDark ? '"‚òÄÔ∏è"' : '"üåô"');
  });


async function sendMessage() {
  const input = document.getElementById("user-input");
  const chatBox = document.getElementById("chat-box");
  const message = input.value.trim();
  if (!message) return;

  const userMsg = document.createElement("div");
  userMsg.className = "user";
  userMsg.textContent = message;
  chatBox.appendChild(userMsg);
  input.value = "";

  chatBox.scrollTop = chatBox.scrollHeight;

  // Add typing bubble immediately
  const typingBubble = document.createElement("div");
  typingBubble.className = "bot";
  typingBubble.id = "typing";
  typingBubble.innerHTML = `<em>typing</em><span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>`;
  chatBox.appendChild(typingBubble);
  chatBox.scrollTop = chatBox.scrollHeight;

  try {
    const response = await fetch("https://ai-girlfriend-8cuy.onrender.com/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        user_id: userId,
        message,
        personality: selectedMood
      })
    });

    const data = await response.json();
    console.log("Response from backend:", data);

    // Remove typing bubble
    const existingTyping = document.getElementById("typing");
    if (existingTyping) existingTyping.remove();

    const botMsg = document.createElement("div");
    botMsg.className = "bot";
    botMsg.textContent = data.reply || "Sorry babe, I'm a little lost. Try again?";
    chatBox.appendChild(botMsg);
    chatBox.scrollTop = chatBox.scrollHeight;
  } catch (err) {
    console.error("Error sending message:", err);

    const existingTyping = document.getElementById("typing");
    if (existingTyping) existingTyping.remove();

    const botMsg = document.createElement("div");
    botMsg.className = "bot";
    botMsg.textContent = "Sorry love, I'm a little lost. Try again?";
    chatBox.appendChild(botMsg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }
}


  document.getElementById("mood").addEventListener("change", setMood);

  async function setMood() {
    const mood = document.getElementById("mood").value;
    selectedMood = mood;
    await fetch("https://ai-girlfriend-8cuy.onrender.com/set_personality", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user_id: userId, mood })
    });
  }

  window.onload = async function () {
    const moodDropdown = document.getElementById("mood");

    try {
        const response = await fetch(`https://ai-girlfriend-8cuy.onrender.com/get_personality/${userId}`);
        const data = await response.json();

        selectedMood = data.mood || "romantic";  // fallback to romantic
        moodDropdown.value = selectedMood;

    // If mood was not already set, set it on backend
        if (!data.mood) {
            await fetch("https://ai-girlfriend-8cuy.onrender.com/set_personality", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_id: userId, mood: selectedMood })
            });
        }

    } catch (e) {
    // If backend fails, fallback to romantic
            selectedMood = "romantic";
            moodDropdown.value = selectedMood;
    }
  };

</script>
</body>
</html>
